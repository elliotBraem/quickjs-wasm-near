<!doctype html><html><head><style>textarea#sourcecode{width:500px;height:300px}</style></head><body><p><textarea id="sourcecode"></textarea></p><p><button id="deploybutton">Deploy</button></p><p><label for="contractnameinput">contract name</label><input id="contractnameinput"> <label for="methodnameinput">method name</label><input id="methodnameinput"> <label for="argsinput">args</label><input id="argsinput"></p><p><button id="callcontractbutton">Call contract</button></p><script type="module">import"https://cdn.jsdelivr.net/npm/near-api-js@0.44.2/dist/near-api-js.min.js";const e={nodeUrl:"https://rpc.testnet.near.org",archiveNodeUrl:"https://archival-rpc.testnet.near.org",walletUrl:"https://wallet.testnet.near.org",helperUrl:"https://helper.testnet.near.org",networkId:"testnet",contractName:"dev-1650702826986-24017505724534",deps:{keyStore:null}},t=new Promise((async t=>{e.deps.keyStore=new nearApi.keyStores.BrowserLocalStorageKeyStore;const n=await nearApi.connect(e);t(new nearApi.WalletConnection(n))}));async function n(){const n=await t,r=n.account();return await r.connection.signer.getPublicKey(r.accountId,r.connection.networkId)||n.signOut(),n.isSignedIn()||await n.requestSignIn(e.contractName,"js-on-near"),n}class r{constructor(e,t,n){this.memory=e,this.malloc=t,this.free=n}convertToString(e,t){try{const n=new Uint8Array(this.memory.buffer,e,t),r=new TextDecoder;return r.decode(n)}finally{this.free(e)}}convertFromString(e){const t=(new TextEncoder).encode(e),n=this.malloc(t.byteLength),r=new Uint8Array(this.memory.buffer,n,t.byteLength+1);return r.set(t),r}}const o=64n;function a(e,t,n){let r=t+n;for(;r.includes("\n");){const[t,n]=r.split("\n",2);e(t),r=n}return r}class s{constructor(e){this.env=e,this.instance=null,this.wasiMemoryManager=null,this.stdoutText="",this.stderrText=""}init=e=>{this.instance=e,this.wasiMemoryManager=new r(e.exports.memory,e.exports.malloc,e.exports.free)};environ_get=(e,t)=>{const n=new TextEncoder,r=new DataView(this.wasiMemoryManager.memory.buffer);return Object.entries(this.env).map((([e,t])=>`${e}=${t}`)).forEach((o=>{r.setUint32(e,t,!0),e+=4;const a=n.encode(o),s=new Uint8Array(this.wasiMemoryManager.memory.buffer,t,a.length+1);t+=s.byteLength})),0};environ_sizes_get=(e,t)=>{const n=new TextEncoder,r=new DataView(this.wasiMemoryManager.memory.buffer),o=Object.entries(this.env).map((([e,t])=>`${e}=${t}`)),a=o.reduce(((e,t)=>e+n.encode(t).byteLength+1),0);return r.setUint32(e,o.length,!0),r.setUint32(t,a,!0),0};proc_exit=e=>0;fd_close=e=>0;fd_seek=(e,t,n,r,o)=>0;fd_write=(e,t,n,r)=>{if(!(1===e|2===e))return 8;const o=new DataView(this.wasiMemoryManager.memory.buffer),s=Array.from({length:n},((e,n)=>{const r=t+8*n,a=o.getUint32(r,!0),s=o.getUint32(r+4,!0);return new Uint8Array(this.wasiMemoryManager.memory.buffer,a,s)})),c=new TextDecoder;let i=0,l="";return s.forEach((e=>{l+=c.decode(e),i+=e.byteLength})),o.setUint32(r,i,!0),1===e?this.stdoutText=a(console.log,this.stdoutText,l):2==e&&(this.stderrText=a(console.error,this.stderrText,l)),0};random_get=()=>0;fd_fdstat_get=(e,t)=>{if(!(1===e|2===e))return 8;const n=new DataView(this.wasiMemoryManager.memory.buffer);return n.setUint8(t+0,2),n.setUint32(t+2,1,!0),n.setBigUint64(t+8,o,!0),n.setBigUint64(t+16,o,!0),0};clock_time_get=e=>{console.log("clock get time",e)}}const c=async()=>{const e=new s({LANG:"en_GB.UTF-8",TERM:"xterm"}),t=await fetch(new URL(new URL("assets/jseval-c1825523.wasm",import.meta.url).href,import.meta.url)).then((e=>e.arrayBuffer())),n=(await WebAssembly.instantiate(t,{wasi_snapshot_preview1:e})).instance;return e.init(n),n.exports},i=async e=>{const t=await c(),n=t.malloc(e.length+1),r=new Uint8Array(t.memory.buffer,n,e.length);for(let t=0;t<e.length;t++)r[t]=e.charCodeAt(t);return t.eval_js_source(n)},l=async e=>{const t=await c(),n=t.malloc(e.length),r=new Uint8Array(t.memory.buffer,n,e.length);for(let t=0;t<e.length;t++)r[t]=e[t];return t.eval_js_bytecode(n,r.length)},m=async(e,t=!1)=>{const n=await c(),r=n.malloc(e.length+1),o=new Uint8Array(n.memory.buffer,r,e.length);for(let t=0;t<e.length;t++)o[t]=e.charCodeAt(t);const a=n.malloc(4),s=n.compile_to_bytecode(r,a,t),i=new Uint32Array(n.memory.buffer,a,4)[0];return console.log("len",i),new Uint8Array(n.memory.buffer,s,i)};!async function(){console.log("eval js",await i('(function () {return 11+34+55+"test".length})()')),console.log("eval bytecode",await l([2,2,8,116,101,115,116,26,104,101,108,108,111,95,110,101,97,114,46,106,115,14,0,6,0,160,1,0,1,0,2,0,0,10,1,162,1,0,0,0,4,222,0,0,0,233,185,157,205,40,190,3,1,0]));let e=await m('(function () {return 11+34+55+"test".length})()');console.log("eval compiled bytecode",await l(e)),console.log("JSON parse",await i("JSON.parse('1')")),console.log("JSON parse in bytecode",await l([2,2,10,112,97,114,115,101,26,104,101,108,108,111,95,110,101,97,114,46,106,115,14,0,6,0,160,1,0,1,0,3,0,1,17,1,162,1,0,0,0,56,155,0,0,0,66,222,0,0,0,191,0,36,1,0,205,40,190,3,1,0,7,2,49])),console.log("JSON parse compile and eval",await l(await m("JSON.parse('{\"a\": 222}').a+3")))}();const u=document.getElementById("deploybutton"),f=document.getElementById("sourcecode"),d=localStorage.getItem("lastSavedSourceCode");f.value=d||'export function hello() {\n    env.log("Hello Near");\n}',u.addEventListener("click",(async()=>{localStorage.setItem("lastSavedSourceCode",d);!async function(r){const o=await t;await n(),await o.account().functionCall(e.contractName,"deploy_js_contract",r,null,nearApi.utils.format.parseNearAmount(""+r.length/1e3))}(await m(f.value,!0))}));const g=document.getElementById("callcontractbutton"),y=document.getElementById("contractnameinput"),w=document.getElementById("methodnameinput"),h=document.getElementById("argsinput");g.addEventListener("click",(async()=>{console.log(await async function(t,r,o){const a=await n();let s=Buffer.concat([Buffer.from(t),Buffer.from([0]),Buffer.from(r),Buffer.from([0]),Buffer.from(o)]);return await a.account().functionCall(e.contractName,"call_js_contract",s)}(y.value,w.value,h.value))})),(async()=>{y.value=(await t).account().accountId})();
</script></body></html>